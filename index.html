<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Kalkulator Metabolisme & Estimasi Diet</title>

    <!-- MathJax -->
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Icon -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <!-- CSS External -->
    <link rel="stylesheet" href="style.css">
</head>

<body>

    <!-- ========================== HEADER ========================== -->
    <header class="topbar">
        <div class="left">
            <img src="logo.jpg" alt="Logo Kampus">
            <div>
                <div class="group">Turunan ‚Äì Kelompok 1</div>
                <div class="course">Kalkulus Diferensial</div>
            </div>
        </div>

        <div class="social">
            <a href="https://instagram.com/jlvnnw" target="_blank" class="instagram">
                <i class="fab fa-instagram"></i>
            </a>
            <a href="https://wa.me/6281274330984" target="_blank" class="whatsapp">
                <i class="fab fa-whatsapp"></i>
            </a>
            <a href="mailto:julvinrnwaruwu@gmail.com?subject=Pertanyaan&body=Halo..." class="email">
                <i class="fas fa-envelope"></i>
            </a>
        </div>
    </header>

    <!-- ========================== HERO ========================== -->
    <header class="hero">
        <div class="hero-inner">
            <h1>Kalkulator Metabolisme & Estimasi Diet</h1>
            <p class="sub">Analisis & prediksi estimasi kalori selama 7 hari serta Berat 30 hari.</p>

            <!-- Menu -->
            <div class="feature-box">
                <div class="card-menu" data-open="panel-theory">
                    <span class="icon">üè†Ô∏é</span> <span>Teori & Rumus</span>
                </div>
                <div class="card-menu" data-open="panel-usage">
                    <span class="icon">üìÑ</span> <span>Cara Penggunaan</span>
                </div>
                <div class="card-menu active" data-open="panel-test">
                    <span class="icon">üìù</span> <span>Calorie Calculator</span>
                </div>
            </div>
        </div>
    </header>

    <!-- ========================== MAIN ========================== -->
    <main class="container">

        <!-- ==================== PANEL 1: TEORI ==================== -->
        <section id="panel-theory" class="panel">
            <h2>üè†Ô∏é Teori & Rumus</h2>

            <div class="panel-grid">

                <!-- Card 1 -->
                <article class="card">
                    <h3>Landasan Teori</h3>

                    <p><b>BMR</b> adalah jumlah energi minimum yang diperlukan tubuh untuk 
                        mempertahankan fungsi vital saat istirahat. Rumus ini mepertimbangkan
                        berat badan, tinggi badan, usia, dan jenis kelamin.</p>
                    <p><b>TDEE</b> adalah total energi harian yang dikeluarkan tubuh termasuk
                        aktivitas fisik. Nilai ini digunakan menentukan kebutuhan kalori untuk
                        menjaga, menaikkan, atau menurunkan berat badan.</p>
                    <p><b>Selisih Kalori<b> digunakan untuk melihat apakah tubuh berada dalam kondisi
                    defisit (turun berat) atau surplus (naik berat).</p>

                    <p>üìä Grafik Kalori membantu memonitor:</p>
                    <ul>
                        <li>Surplus kalori ‚Üí potensi naik berat</li>
                        <li>Defisit kalori ‚Üí potensi turun berat</li>
                        <li>Seimbang ‚Üí berat stabil</li>
                    </ul>

                    <p>üìÖ Grafik Tren 30 Hari memberi gambaran jangka panjang pola diet.</p>
                </article>

                <!-- Card 2 -->
                <article class="card">
                    <h2>Rumus BMR ‚Äì TDEE ‚Äì Selisih</h2>

                    <h3>1. Rumus BMR (Mifflin‚ÄìSt Jeor)</h3>
                    <p>Pria:</p>
                    <h3><center>\[BMR :\]</center></h3>
                    <p class="rumus">\[(10√óberat)+(6.25√ótinggi)-(5√óusia)+5 \]</p>

                    <p>Wanita:</p>
                    <h3><center>\[BMR :\]</center></h3>
                    <p class="rumus">\[(10√óberat)+(6.25√ótinggi)-(5√óusia)-161 \]</p>

                    <h3>2. Rumus TDEE</h3>
                    <p>\[ TDEE = BMR √ó Faktor\ Aktivitas \]</p>

                    <h3>3. Selisih Kalori</h3>
                    <p>\[ Selisih = Intake - TDEE \]</p>
                </article>

                <!-- Card 3 -->
                <article class="card">
                    <h3>Landasan Teori Kalkulus</h3>

                    <p>\[ \frac{dW}{dt} = k (C_{in} - C_{out}) \]</p>

                    <p>\[ ŒîE = \int_0^T (C_{in} - TDEE)\, dt \]</p>
                </article>
            </div>
        </section>

        <!-- ==================== PANEL 2: CARA PAKAI ==================== -->
        <section id="panel-usage" class="panel">
            <h2>Cara Penggunaan</h2>
            <p>Kalkulator ini menghitung BMR, TDEE dan memberi rekomendasi diet.</p>
<div class="usage-steps"> 
<div class="step">
    <span class="num">1</span>
    <h3>Masukkan Data</h3>
    <div class="step-info">
        Masukkan berat badan, tinggi, usia, jenis kelamin, dan kalori harian Anda.
    </div>
</div>
<div class="step">
    <span class="num">2</span>
    <h3>Pilih Aktivitas</h3>
    <div class="step-info">
        Pilih tingkat aktivitas fisik untuk menentukan faktor TDEE.
    </div>
</div>
<div class="step">
    <span class="num">3</span>
    <h3>Klik Hitung</h3>

    <div class="step-info">
        Sistem akan menghitung BMR, TDEE, dan selisih kalori secara otomatis.
    </div>
</div>
<div class="step">
    <span class="num">4</span>
    <h3>Lihat Hasil</h3>

    <div class="step-info">
        Hasil perhitungan dan grafik estimasi dapat dilihat secara langsung.
    </div>
</div>

            
        </section>

        <!-- ==================== PANEL 3: FORM ==================== -->
        <section id="panel-test" class="panel active">
            <h2>Form Input & Tes</h2>

            <div class="grid-2">

                <!-- Form -->
                <div class="card form-card">
                    <h3>Input</h3>

                    <div class="row">
                        <div class="label-box">Berat (kg)</div>
                        <input id="weight" type="number" class="input-box">
                    </div>

                    <div class="row">
                        <div class="label-box">Tinggi (cm)</div>
                        <input id="height" type="number" class="input-box">
                    </div>

                    <div class="row">
                        <div class="label-box">Usia</div>
                        <input id="age" type="number" class="input-box">
                    </div>

                    <div class="row">
                        <div class="label-box">Jenis Kelamin</div>
                        <select id="gender" class="input-box">
                            <option value="male">Laki-laki</option>
                            <option value="female">Perempuan</option>
                        </select>
                    </div>

                    <div class="row">
                        <div class="label-box">Aktivitas</div>
                        <select id="activity" class="input-box">
                            <option value="1.2">Tidak Aktif</option>
                            <option value="1.375">Ringan (pekerjaan rumah)</option>
                            <option value="1.55">Sedang  (olahraga 2-3 kali seminggu)</option>
                            <option value="1.725">Berat  (olahraga 4-6 kali seminggu)</option>
                            <option value="1.9">Atlet  (Performa tinggi/Profesional)</option>
                        </select>
                    </div>

                    <div class="row">
                        <div class="label-box">Kalori / hari</div>
                        <input id="calorie" type="number" class="input-box">
                    </div>

                    <div class="row">
                        <div class="label-box">Tujuan</div>
                        <select id="goal" class="input-box">
                            <option value="cutting">Diet (mengurangi berat badan)</option>
                            <option value="bulking">Bulking (menambah berat badan)</option>
                        </select>
                    </div>

                    <div class="result-card" id="resultCard">
                        <div><strong>BMR (Basal Metabolic Rate):</strong> <span id="bmrValue">‚Äî</span> kCal</div>
                        <div><strong>TDEE (Total Daily Energy Expenditure):</strong> <span id="tdeeValue">‚Äî</span> kCal</div>
                        <div><strong>Selisih kalori:</strong> <span id="diffValue">‚Äî</span> kCal</div>
                    </div>

                    <div class="action-buttons">
                        <button id="calcBtn" class="hitungBtn">Hitung</button>                         <button id="resetBtn" class="btn ghost">Reset Hasil</button>
    <button id="btnReset" class="btn reset">Reset Data</button>
</div>

                      </div>
                </div>

                <!-- Info -->
                <aside class="card info-card">
                    <div class="kalori-makanan-card">

    <h3>Kalori Makanan</h3>

    <p>Nasi 100g : 130 kCal</p>
    <p>Dada ayam 100g : 165 kCal</p>
    <p>Sayur 100g : 25 kCal</p>

    <!-- Tambahan fitur -->
    <div class="food-input">
        <select id="foodSelect">
            <option value="">Pilih makanan</option>
            <option value="130">Nasi Putih (100g)</option>
            <option value="165">Dada Ayam (100g)</option>
            <option value="250">Ayam Goreng</option>
            <option value="70">Telur Rebus</option>
            <option value="380">Mie Instan</option>
            <option value="120">Tempe Goreng</option>
        </select>

        <input
            type="number"
            id="foodQty"
            placeholder="Porsi"
            min="1"
            value="1"
        />

        <button id="addFoodBtn">Tambah</button>
    </div>

    <div class="food-list" id="foodList"></div>

    <div class="total-kalori">
        Total Kalori Konsumsi:
        <strong><span id="totalKalori">0</span> kCal</strong>
    </div>

</div>


                    <h4>Grafik</h4>
                    <button class="btn" data-open="panel-graphs">Buka Grafik</button>
                </aside>

            </div>
        </section>

        <!-- ==================== PANEL 4: GRAFIK ==================== -->
        <section id="panel-graphs" class="panel">
            <h2>Grafik</h2>

            <div class="chart-grid">
                <div class="chart-card">
                    <h3>Estimasi Kalori (7 Hari)</h3>
                    <canvas id="kaloriChart"></canvas>
                </div>

                <div class="chart-card">
                    <h3>Prediksi Berat (30 Hari)</h3>
                    <canvas id="weightChart"></canvas>
                </div>
            </div>
        </section>

    </main>

    <!-- ========================== FOOTER ========================== -->
    <footer class="footer">
        <small>Proyek Kelompok 1 PSIK 25D</small>
    </footer>

    <!-- ========================== JAVASCRIPT ========================== -->
    <script>
        /* Semua script yang kamu kirim dimasukkan di sini TANPA mengubah logika */

        /* ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî Utility ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî */
const qs = v => document.querySelector(v);
const qsa = v => document.querySelectorAll(v);

let kaloriChart = null;
let weightChart = null;
let totalKalori = 0;
let foodData = [];

/* Element DOM */
const panels = qsa('.panel');
const openButtons = qsa('[data-open]');

const weightInput = qs('#weight');
const heightInput = qs('#height');
const ageInput = qs('#age');
const genderInput = qs('#gender');
const activityInput = qs('#activity');
const calorieInput = qs('#calorie');
const goalInput = qs('#goal');

const bmrDisplay = qs('#bmrValue');
const tdeeDisplay = qs('#tdeeValue');
const diffDisplay = qs('#diffValue');

const calcBtn = qs('#calcBtn');
const resetBtn = qs('#resetBtn');

/* ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî Panel open ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî */
function openPanel(id) {
    panels.forEach(p => p.classList.remove('active'));
    qs('#' + id).classList.add('active');

    if (id === "panel-graphs") {
        initOrUpdateCharts();
    }
}

openButtons.forEach(btn =>
    btn.addEventListener('click', () => openPanel(btn.dataset.open))
);

/* ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî BMR Calc ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî */
function calcBMR(w, h, a, gender) {
    if (!w || !h || !a) return 0;

    if (gender === "male") {
        return (10 * w) + (6.25 * h) - (5 * a) + 5;
    } else {
        return (10 * w) + (6.25 * h) - (5 * a) - 161;
    }
}

function animateValue(el, start, end, duration = 600) {
    const range = end - start;
    const startTime = performance.now();

    function step(now) {
        const progress = Math.min((now - startTime) / duration, 1);
        el.textContent = Math.round(start + range * progress);
        if (progress < 1) requestAnimationFrame(step);
    }
    requestAnimationFrame(step);
}


/* ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî Grafik Data ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî */
function genKalori7days(tdee) {
    return Array(7).fill(Math.round(tdee));
}

function genWeight30days(initialWeight, diff) {
    const arr = [];
    let w = Number(initialWeight);
    const kgPerDay = diff / 7700; // 7700 kCal = 1 kg

    for (let i = 0; i < 30; i++) {
        w += kgPerDay;
        arr.push(Number(w.toFixed(1)));
    }
    return arr;
}

/* ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî Update Grafik ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî */
function initOrUpdateCharts() {

    const w = Number(weightInput.value);
    const h = Number(heightInput.value);
    const a = Number(ageInput.value);
    const g = genderInput.value;
    const ac = Number(activityInput.value);
    const intake = Number(calorieInput.value);

    const bmr = calcBMR(w, h, a, g);
    const tdee = bmr * ac;
    const diff = Math.round(intake - tdee);

    // Update display animasi
    animateValue(bmrDisplay, Number(bmrDisplay.textContent) || 0, Math.round(bmr));
    animateValue(tdeeDisplay, Number(tdeeDisplay.textContent) || 0, Math.round(tdee));
    animateValue(diffDisplay, Number(diffDisplay.textContent) || 0, diff);

    const kaloriData = genKalori7days(tdee);
    const weightData = genWeight30days(w, diff);

    const kaloriCtx = qs('#kaloriChart').getContext('2d');
    const weightCtx = qs('#weightChart').getContext('2d');

    // Chart Kalori
    if (kaloriChart) {
        kaloriChart.data.datasets[0].data = kaloriData;
        kaloriChart.update();
    } else {
        kaloriChart = new Chart(kaloriCtx, {
    type: 'line',
    data: {
        labels: ["1","2","3","4","5","6","7"],
        datasets: [{
            label: "Estimasi Kalori Terbakar",
            data: kaloriData,
            borderColor: "#4aa2e9",
            backgroundColor: "rgba(74,162,233,0.12)",
            tension: 0.4,
            fill: true
        }]
    },
    options: {
        responsive: true,
        scales: {
            x: {
                ticks: {
                    color: "#ffffff",      // WARNA ANGKA 1‚Äì7
                    font: {
                        size: 13,
                        weight: "600"
                    }
                },
                title: {
                    display: true,
                    text: "Hari",
                    align: "center",
                    color: "#eaf4ff",
                    font: {
                        size: 14,
                        weight: "600"
                    },
                    padding: {
                        top: 10
                    }
                }
            },
            y: {
                ticks: {
                    color: "#cfdff0"
                }
            }
        },
        plugins: {
            legend: {
                labels: {
                    color: "#eaf4ff"
                }
            }
        }
    }
});

    }

    // Chart Berat
if (weightChart) {

    weightChart.data.datasets[0].data = weightData;
    weightChart.update();

} else {

    weightChart = new Chart(weightCtx, {
        type: 'line',
        data: {
            labels: Array.from({ length: 30 }, (_, i) => `${i + 1}`),
            datasets: [{
                label: "Prediksi Berat (kg)",
                data: weightData,
                borderColor: "#ffd166",
                backgroundColor: "rgba(255,209,102,0.06)",
                tension: 0.35,
                fill: true
            }]
        },
        options: {
            responsive: true,
            scales: {
                x: {
                    ticks: {
                        color: "#ffffff",   // WARNA ANGKA 1‚Äì30
                        font: {
                            size: 11,
                            weight: "600"
                        },maxRotation: 0,
        minRotation: 0,
        autoSkip: true
                    },
                    title: {
                        display: true,
                        text: "Hari",
                        align: "center",
                        color: "#ffffff",   // WARNA TEKS "Hari"
                        font: {
                            size: 14,
                            weight: "600"
                        },
                        padding: {
                            top: 10
                        }
                    }
                },
                y: {
                    ticks: {
                        color: "#cfdff0"
                    }
                }
            },
            plugins: {
                legend: {
                    labels: {
                        color: "#ffffff"
                    }
                }
            }
        }
    });
}

}

/* ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî Event ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî */calcBtn.addEventListener("click", () => {
    openPanel("panel-graphs");
    initOrUpdateCharts();

    const resultCard = document.getElementById("resultCard");
    if (resultCard) {
        resultCard.classList.remove("glow");
        void resultCard.offsetWidth;
        resultCard.classList.add("glow");
    }
});

resetBtn.addEventListener("click", () => {
    weightInput.value = "";
    heightInput.value = "";
    ageInput.value = "";
    calorieInput.value = "";
    genderInput.value = "male";
    activityInput.value = "1.2";

    animateValue(bmrDisplay, Number(bmrDisplay.textContent) || 0, 0);
    animateValue(tdeeDisplay, Number(tdeeDisplay.textContent) || 0, 0);
    animateValue(diffDisplay, Number(diffDisplay.textContent) || 0, 0);

    if (qs('#panel-graphs').classList.contains('active')) {
        initOrUpdateCharts();
    }
});

const foodSelect = document.getElementById("foodSelect");
const foodQty = document.getElementById("foodQty");
const addFoodBtn = document.getElementById("addFoodBtn");
const foodList = document.getElementById("foodList");
const totalKaloriEl = document.getElementById("totalKalori");

addFoodBtn.addEventListener("click", () => {
    const kalori = Number(foodSelect.value);
    const qty = Number(foodQty.value);

    if (!kalori || qty <= 0) return;

    const nama = foodSelect.options[foodSelect.selectedIndex].text;
    const total = kalori * qty;

    foodData.push({ nama, qty, total });
    totalKalori += total;

    updateTotalCalories();
    renderFoodList();

    foodQty.value = 1;
});


document.getElementById("btnReset").addEventListener("click", () => {
    foodData = [];
    totalKalori = 0;

    renderFoodList();
    updateTotalCalories();

    foodSelect.selectedIndex = 0;
    foodQty.value = 1;
});

function renderFoodList() {
    foodList.innerHTML = "";

    foodData.forEach((item, index) => {
        const div = document.createElement("div");
        div.className = "food-item";
        div.innerHTML = `
            <span>${item.nama} x${item.qty}</span>
            <span>
                ${item.total} kCal
                <button class="hapus-btn" data-index="${index}">‚úï</button>
            </span>
        `;
        foodList.appendChild(div);
    });

    // tombol hapus per item
    document.querySelectorAll(".hapus-btn").forEach(btn => {
        btn.addEventListener("click", e => {
            const i = e.target.dataset.index;
            totalKalori -= foodData[i].total;
            foodData.splice(i, 1);
            updateTotalCalories();
            renderFoodList();
        });
    });
}

function updateTotalCalories() {
    totalKaloriEl.textContent = totalKalori;
}



window.addEventListener("load", () => openPanel("panel-test"));

    </script>

</body>
</html>